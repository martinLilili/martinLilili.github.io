---
layout: post
title: iOSå¼€å‘tips
date: 2016-11-23
categories: blog
tags: [æ€»ç»“,çŸ¥è¯†ç®¡ç†]
description: swiftå¼€å‘tips
---



## æ‰“log

åœ¨ Xcode çš„ Build Setting ä¸­ï¼Œåœ¨ Other Swift flags çš„ Debug æ ä¸­åŠ å…¥ -D DEBUG å³å¯åŠ å…¥ä¸€ä¸ªç¼–è¯‘æ ‡è¯†ã€‚

![Other Swift flags](http://oh36yj5vw.bkt.clouddn.com/debug-flag.png)

æ·»åŠ æ–¹æ³•ï¼š

	/// æ‰“logæ–¹æ³•ï¼Œreleaseä¸ä¼šè¾“å‡º
	 ///
	/// - Parameters:
	///   - message: log æ–‡æœ¬
	///   - fileName: æ–‡ä»¶åï¼Œæœ‰é»˜è®¤å€¼
	///   - methodName: æ–¹æ³•åï¼Œæœ‰é»˜è®¤å€¼
	///   - lineNumber: è¡Œæ•°ï¼Œæœ‰é»˜è®¤å€¼
	public func DebugLog<T>(item: T, fileName: String = #file, methodName: String =  #function, lineNumber: Int = #line)
	{
	    #if DEBUG
	    let str : String = ((fileName as NSString).pathComponents.last! as NSString).replacingOccurrences(of: "swift", with: "")
	    print("\(str)\(methodName)[\(lineNumber)]:\(item)")
	    #endif
	}
       
æµ‹è¯•ï¼Œåœ¨didFinishLaunchingWithOptionsæ‰“å°å„ç§æƒ…å†µï¼š

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {
        // Override point for customization after application launch.

        DebugLog(item: "è¾“å‡ºå­—ç¬¦ä¸²")
        DebugLog(item: ["arr1", "arr2"])
        DebugLog(item: ["key" : "value"])
        DebugLog(item: testLog())
        return true
    }
    
    func testLog() -> String {
        DebugLog(message: "test")
        return "testResult"
    }       
       
è¾“å‡ºç»“æœï¼š

    AppDelegate.application(_:didFinishLaunchingWithOptions:)[20]:è¾“å‡ºå­—ç¬¦ä¸²
    AppDelegate.application(_:didFinishLaunchingWithOptions:)[21]:["arr1", "arr2"]
    AppDelegate.application(_:didFinishLaunchingWithOptions:)[22]:["key": "value"]
    AppDelegate.testLog()[28]:test
    AppDelegate.application(_:didFinishLaunchingWithOptions:)[23]:testResult   
    
æ³¨æ„è¿™é‡Œå¦‚æœä½ ä¼ å…¥çš„ items æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼è€Œä¸æ˜¯ç›´æ¥çš„å˜é‡çš„è¯ï¼Œè¿™ä¸ªè¡¨è¾¾å¼è¿˜æ˜¯ä¼šè¢«å…ˆæ‰§è¡Œæ±‚å€¼çš„ã€‚å¦‚æœè¿™å¯¹æ€§èƒ½ä¹Ÿäº§ç”Ÿäº†å¯æµ‹çš„å½±å“çš„è¯ï¼Œæˆ‘ä»¬æœ€å¥½ç”¨ @autoclosure ä¿®é¥°å‚æ•°æ¥é‡æ–°åŒ…è£… printã€‚è¿™å¯ä»¥å°†æ±‚å€¼è¿è¡Œæ¨è¿Ÿåˆ°æ–¹æ³•å†…éƒ¨ï¼Œè¿™æ ·åœ¨ Release æ—¶è¿™ä¸ªæ±‚å€¼ä¹Ÿä¼šè¢«ä¸€å¹¶å»æ‰ï¼š 
 
    func dPrint(@autoclosure item: () -> Any) {
        #if DEBUG
        print(item())
        #endif
    }

    dPrint(resultFromHeavyWork())
    // Release ç‰ˆæœ¬ä¸­ resultFromHeavyWork() ä¸ä¼šè¢«æ‰§è¡Œ     
    
    
    
## xcode8æ·»åŠ æ³¨é‡Šå¿«æ·é”®

![zhushi](http://oh36yj5vw.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-11-23%20%E4%B8%8B%E5%8D%885.16.37.png)
       

### é—­åŒ…å¾ªç¯å¼•ç”¨çš„è§£å†³åŠæ³•å’ŒåŒºåˆ«

å‚è€ƒ[å†…å­˜ç®¡ç†ï¼ŒWEAK å’Œ UNOWNED](http://swifter.tips/retain-cycle/)

#### æ–¹æ³•1: OC çš„æ–¹æ³•
æ³¨æ„weak çš„å˜é‡åœ¨è¿è¡Œæ—¶æœ‰å¯èƒ½è¢«è®¾ç½®ä¸º nilï¼Œweakä¸èƒ½ä½¿ç”¨ let

    //weakSelf -> ViewController? 
    //self - ViewController
    //'weak' must be a mutable variable, because it may change at runtime
    //weak çš„å˜é‡åœ¨è¿è¡Œæ—¶æœ‰å¯èƒ½è¢«è®¾ç½®ä¸º nilï¼Œweakä¸èƒ½ä½¿ç”¨ let
    
    weak var weakSelf = self
    loadData { (result) -> () in
        print(result)
        print(weakSelf)
    }       
    
#### æ–¹æ³•2: Swift çš„æ–¹æ³•[weak self] ï¼ é¦–é€‰
    // [weak self] è¡¨ç¤º é—­åŒ…ä¸­çš„ self éƒ½æ˜¯å¼±å¼•ç”¨çš„ï¼Œä¸éœ€è¦å†ä½¿ç”¨å…¶ä»–çš„å˜é‡
    // weak çš„å˜é‡åœ¨è¿è¡Œæ—¶æœ‰å¯èƒ½è¢«è®¾ç½®ä¸º nilï¼Œæ‰€ä»¥é—­åŒ…ä¸­çš„ selfï¼Œéƒ½æ˜¯å¯é€‰çš„
    loadData { [weak self] (result) -> () in
         // unexpectedly found nil while unwrapping an Optional value
         // ! å¼ºè¡Œè§£åŒ…ï¼Œå€¼ä¸å­˜åœ¨æŠ›å‡ºå¼‚å¸¸
         // ? å¯é€‰è§£åŒ…ï¼Œå€¼ä¸å­˜åœ¨ï¼Œç»™nilå‘é€æ¶ˆæ¯
         print(self?.view)
     }
        
#### æ–¹æ³•3: [unowned self]
    // [unowned self] å’Œ OC ä¸­çš„ assign æ˜¯ä¸€æ ·çš„ï¼Œå¯¹è±¡é‡Šæ”¾ä¹‹åï¼ŒæŒ‡é’ˆä¿æŒä¸å˜
    // 1> é—­åŒ…ä¸­ä¸éœ€è¦è€ƒè™‘è§£åŒ…çš„é—®é¢˜
    // 2> ä½†æ˜¯å¦‚æœ self é‡Šæ”¾ï¼Œä¼šå‡ºç°é‡æŒ‡é’ˆè®¿
    loadData { [unowned self] (result) -> () in
        // EXC_BREAKPOINT é‡æŒ‡é’ˆè®¿é—®
        print(self.view)
     }
     
##### weak å’Œ unowned å…³äºä¸¤è€…ä½¿ç”¨çš„é€‰æ‹©ï¼ŒApple ç»™æˆ‘ä»¬çš„å»ºè®®æ˜¯å¦‚æœèƒ½å¤Ÿç¡®å®šåœ¨è®¿é—®æ—¶ä¸ä¼šå·²è¢«é‡Šæ”¾çš„è¯ï¼Œå°½é‡ä½¿ç”¨ unownedï¼Œå¦‚æœå­˜åœ¨è¢«é‡Šæ”¾çš„å¯èƒ½ï¼Œé‚£å°±é€‰æ‹©ç”¨ weak     


## Swift å…³äºè®¡ç®—å±æ€§çš„ä¸€ç§ç”¨æ³•

ä»Šå¤©çœ‹äº†å–µç¥çš„[Kingfisher](https://github.com/onevcat/Kingfisher)é¡¹ç›®ä»£ç ï¼Œå‘ç°ä¸€æ®µæœ‰è¶£çš„ä»£ç ï¼Œç»™æˆ‘é€ æˆäº†å¾ˆå¤§å›°æ‰°ï¼š

     
    public final class Kingfisher<Base> {
        public let base: Base
        public init(_ base: Base) {
            self.base = base
        }
    }

    /**
     A type that has Kingfisher extensions.
     */
    public protocol KingfisherCompatible {
        associatedtype CompatibleType
        var kf: CompatibleType { get }
    }

    public extension KingfisherCompatible {
        public var kf: Kingfisher<Self> {
            get { return Kingfisher(self) }
        }
    }

    extension ImageView: KingfisherCompatible { }
    
æ²¡çœ‹è¿‡å…¶ä»–æºç å¯èƒ½ä¸æ˜ç™½æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼š

    class A {
        let base: B
        init(_ base: B) {
            self.base = base
        }
        
        deinit {
            print("A dinit")
        } 
    }

    class B {
        var kf: A {
            get { return A(self) }
        }
        
        deinit {
            print("B dinit")
        }
    }    

çœ‹åˆ°è¿™æ®µä»£ç ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”æ˜¯è°ƒç”¨b.kfè¿™ä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨å—ï¼Ÿ
é€šè¿‡æµ‹è¯•å‘ç°å¹¶ä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ
é€šè¿‡æµ‹è¯•ç»ˆäºå‘ç°äº†å…¶ä¸­çš„é“ç†ï¼š

åŸæ¥æ¯æ¬¡åœ¨è°ƒç”¨b.kfæ—¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Aå¯¹è±¡ï¼Œè€Œä¸”æ˜¯ä¸´æ—¶å˜é‡ï¼Œåœ¨å‡ºäº†å¤§æ‹¬å·åå°±ä¼šè¢«ç«‹å³é‡Šæ”¾ã€‚Bå¹¶æ²¡æœ‰ç›´æ¥æŒæœ‰Açš„å¯¹è±¡ã€‚

æ‰€ä»¥åœ¨é‡åˆ°è®¡ç®—å±æ€§æ—¶ä¸€å®šè¦ç†è§£å¥½å®ƒå…¶ä¸­çš„ä»£ç çš„çœŸæ­£æ„ä¹‰ã€‚åŒæ—¶è¿™ç§å†™æ³•ä¹Ÿå€¼å¾—å­¦ä¹ ã€‚

å‚è€ƒï¼š[å†…å­˜ç®¡ç†ï¼ŒWEAK å’Œ UNOWNED](http://swifter.tips/retain-cycle/)


## å…³äºdidsetä¸èƒ½å†åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨çš„é—®é¢˜

Apple's docs specify that:

willSet and didSet observers are not called when a property is first initialized. They are only called when the propertyâ€™s value is set outside of an initialization context.

æ„æ€æ˜¯ï¼š

    class SomeClass {
        var someProperty: AnyObject {
        	didSet {
            	doStuff()
       	 }
   		 }

    	init(someProperty: AnyObject) {
        	self.someProperty = someProperty
    	}

    	func doStuff() {
       	 // do stuff now that someProperty is set
   	 	}
    }

doStuffæ˜¯ä¸ä¼šè°ƒç”¨çš„ï¼Œè§£å†³æ–¹æ³•ä¹Ÿæœ‰å¾ˆå¤šï¼Œå¦‚ï¼š

    class SomeClass {
   		 var someProperty: AnyObject! {
       	 didSet {
           	 //do some Stuff
       	 }
  		  }

    	init(someProperty: AnyObject) {
        	setSomeProperty(someProperty)
    	}

    	func setSomeProperty(newValue:AnyObject) {
        	self.someProperty = newValue
    	}
    }
    
æˆ–è€…ï¼š

    public class MyNewType : NSObject {
    	public var myRequiredField:Int
    	public var myOptionalField:Float? {
        	willSet {
            	if let newValue = newValue {
                	print("I'm going to change to \(newValue)")
            	}
        	}
        	didSet {
            	if let myOptionalField = self.myOptionalField {
                	print("Now I'm \(myOptionalField)")
           	 }
        	}
    	}

    	override public init() {
        	self.myRequiredField = 1

        	super.init()

        	// Non-defered
        	self.myOptionalField = 6.28

        	// Defered
        	defer {
            	self.myOptionalField = 3.14
       	 }
    	}
	}
	
å¯ä»¥å‚è€ƒï¼š[Is it possible to allow didSet to be called during initialization in Swift?](http://stackoverflow.com/questions/25230780/is-it-possible-to-allow-didset-to-be-called-during-initialization-in-swift)


## xcode 8 Visual Debugging with Xcode
å…·ä½“å¯ä»¥æŸ¥çœ‹[Visual Debugging with Xcode](https://developer.apple.com/videos/play/wwdc2016/410/)
xcode æä¾›äº†æ–°çš„æ–¹å¼å¯ä»¥æ›´å¿«çš„å‘ç°å†…å­˜é—®é¢˜ç­‰ã€‚

è¿™é‡Œè®°å½•ä¸‹å¯¼å‡ºMemory Graphçš„æ–¹æ³•ï¼šå¯ä»¥åœ¨å¯åŠ¨Memory Graphåï¼Œé€‰æ‹© file->Export Memory Graphå¯¼å‡ºæ–‡ä»¶ã€‚


## Swift é€‰é¡¹é›†(option)å†™æ³•

#### åœ¨ocä¸­å†™æ³•å¦‚ä¸‹ï¼š

	typedef enum {
		NSCaseInsensitiveSearch = 1,
		NSLiteralSearch = 2,
		NSBackwardsSearch = 4,
		NSAnchoredSearch = 8,
		NSNumericSearch = 64,
		NSDiacriticInsensitiveSearch = 128,
		NSWidthInsensitiveSearch = 256,
		NSForcedOrderingSearch = 512,
		NSRegularExpressionSearch = 1024
	} NSStringCompareOptions;
	
ä½¿ç”¨:

	NSStringCompareOptions options = NSCaseInsensitiveSearch | NSBackwardsSearch;
	// â†’ 5 (= 1 + 4)	
	
#### åœ¨Swiftä¸­å†™æ³•å¦‚ä¸‹ï¼š

	struct Sports: OptionSet {
	    let rawValue: Int
	
	    static let running = Sports(rawValue: 1)
	    static let cycling = Sports(rawValue: 2)
	    static let swimming = Sports(rawValue: 4)
	    static let fencing = Sports(rawValue: 8)
	    static let shooting = Sports(rawValue: 32)
	    static let horseJumping = Sports(rawValue: 512)
	}	
	
ä½¿ç”¨: 

	let triathlon: Sports = [.swimming, .cycling, .running]
	triathlon.contains(.swimming)  // â†’ true
	triathlon.contains(.fencing)   // â†’ false	
æ³¨æ„èµ‹å€¼éœ€è¦ 2 çš„æ•´æ•°æ¬¡å¹‚æŒ‰ç…§å‡åºèµ‹ç»™ä½ çš„é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å·¦ç§» 1 << 0 è¿™ç§å†™æ³•	
#### è®¨è®ºï¼šå½“æ‚¨ä½¿ç”¨ä¸­æ‹¬å·å°†é€‰é¡¹é›† (option set) æ‹¬èµ·æ¥ä¹‹åï¼Œæ‚¨å°†å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ–°çš„é€‰é¡¹é›†ã€‚è¿™æ„å‘³ç€åœ¨ Swift å½“ä¸­ï¼Œ[.foo] æ˜¯ç­‰åŒäº .foo çš„ã€‚

å½“ä»£ç å½“ä¸­éœ€è¦ä¼ é€’ä¸€ä¸ªé€‰é¡¹é›†çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±åº”è¯¥è®©è¯¥å‚æ•°çœ‹èµ·æ¥åƒä¸€ä¸ªé€‰é¡¹é›†ï¼Œæ‰€ä»¥å»ºè®®åœ¨å†™é€‰é¡¹é›†å‚æ•°æ—¶ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªå€¼ä¹ŸåŠ ä¸Š[]ã€‚

## Swift å…³è”å¯¹è±¡
Swift æ‰©å±•åªèƒ½æ·»åŠ è®¡ç®—å±æ€§ã€‚ç„¶è€Œå¦‚æœä½ æ„¿æ„ç”¨ Objective-C çš„å…³è”å¯¹è±¡ï¼Œä½ å¯ä»¥åœ¨ Swift ä¸­åšä¸€äº›åŒæ ·æœ‰è¶£çš„äº‹ã€‚

æ¨èä¸€ç§å†™æ³•å¦‚ä¸‹ï¼š

	import Foundation
	func associatedObject<ValueType: AnyObject>(
	        base: AnyObject, 
	        key: UnsafePointer<UInt8>, 
	        initialiser: () -> ValueType) 
	        -> ValueType {
	    if let associated = objc_getAssociatedObject(base, key) 
	        as? ValueType { return associated }
	    let associated = initialiser()
	    objc_setAssociatedObject(base, key, associated, 
	                             .OBJC_ASSOCIATION_RETAIN)
	    return associated
	}
	func associateObject<ValueType: AnyObject>(
	        base: AnyObject, 
	        key: UnsafePointer<UInt8>, 
	        value: ValueType) {
	    objc_setAssociatedObject(base, key, value, 
	                             .OBJC_ASSOCIATION_RETAIN)
	}
	
å‡½æ•°å°±é‚£ä¹ˆé•¿ã€‚ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒä»¬ï¼š

	class Miller {} // è¿™æ˜¯æˆ‘ä»¬è¦æ‰©å±•çš„ç±»
	class Cat { // æ¯ä¸ªç£¨åŠä¸»éƒ½æœ‰ä¸€åªçŒ«
	    var name = â€œPussâ€
	}
	private var catKey: UInt8 = 0 // æˆ‘ä»¬è¿˜æ˜¯éœ€è¦è¿™æ ·çš„æ¨¡æ¿
	extension Miller {
	    var cat: Cat { // catã€Œå®é™…ä¸Šã€æ˜¯ä¸€ä¸ªå­˜å‚¨å±æ€§
	        get { 
	            return associatedObject(self, key: &catKey) 
	                { return Cat() } // è®¾ç½®å˜é‡çš„åˆå§‹å€¼
	        }
	        set { associateObject(self, key: &catKey, value: newValue) }
	    }
	}	
	
	
## NSStringFromClass æ›¿ä»£æ–¹æ¡ˆ

åœ¨è‡ªå®šä¹‰ TableViewCell æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨ç±»åä½œä¸º cell çš„ identifierï¼Œåœ¨ocæ—¶æˆ‘ä»¬ç”¨NSStringFromClassæ¥è·å–ç±»åå­—ç¬¦ä¸²ï¼Œä½†æ˜¯swiftæ²¡æœ‰ç›¸åº”çš„æ–¹æ³•ï¼Œä½†swiftæä¾›äº†æ›´ä¼˜é›…çš„æ–¹å¼ï¼š

swift2 æ—¶ï¼š

	// This now works!!!
	String(MyTableViewCell)	
	
swift3ä»¥åï¼š

	// This now works!!!
	String(describing: MyTableViewCell.self)	
	
## ä½¿ç”¨é—­åŒ…åˆå§‹åŒ–

å£°æ˜å¸¸é‡åï¼Œåœ¨ä¸€ä¸ªç´§æ¥ç€çš„é—­åŒ…ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯ä¹‹ååœ¨ viewDidLoad æˆ–å…¶ä»–ç±»ä¼¼çš„æ–¹æ³•ä¸­è¿›è¡Œè®¾ç½®ï¼Œè¿™åœ¨ Swift ä¸­æ˜¯å¾ˆå¸¸è§çš„å†™æ³•ï¼ˆä¹Ÿç¡®å®æ˜¯ä¸€ç§ä¸é”™çš„å†™æ³•ï¼ï¼‰ã€‚

	let purpleView: UIView = {
	    // åœ¨æ­¤åˆå§‹åŒ– view
	    // ç›´æ¥å« "view" çœŸçš„å¥½å—ï¼Ÿ
	    let view = UIView()
	    view.backgroundColor = .purpleColor()
	    return view
	}()	
	
ä½†ä¸Šé¢çš„ä»£ç å¹¶ä¸å¥½çœ‹ï¼Œé—­åŒ…ä¸­çš„viewè¯¥å¦‚ä½•å‘½åï¼Ÿ

ä¸‹é¢æ¨èå¦ä¸€ç§å†™æ³•

	let yellowView: UIView = {
	    $0.backgroundColor = .yellowColor()
	    return $0
	}(UIView())	// ç¡®ä¿è¿™ä¸€è¡Œçš„æ‹¬å·å†…è¦ä¼ å…¥ UIView()
	
è¿™ç›¸å½“äºä¸€ä¸ªæ–¹æ³•ä¼ å…¥ä¸€ä¸ª UIView() å‚æ•°ï¼Œä¹‹ååœ¨å¯¹è¿™ä¸ªUIviewå¯¹è±¡è¿›è¡Œè®¾ç½®ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ˜¾ç¤ºåœ°å†å‘½åä¸€ä¸ªå˜é‡	 


## é—­åŒ…æ•è·

å…ˆå†™ä¸ªå»¶è¿Ÿæ–¹æ³•

	func delay(seconds: Int, closure: ()->()) {
	  let time = DispatchTime.now() + .seconds(seconds)
	  DispatchQueue.main.after(when: time) {
	    print("ğŸ•‘")
	    closure()
	  }
	}

å†™ä¸€ä¸ªæ­£å¸¸çš„é—­åŒ…ï¼š

	func demo4() {
	  var value = 42
	  print("before closure: \(value)")
	  delay(1) {
	    print("inside closure 1, before change: \(value)")
	    value = 1337
	    print("inside closure 1, after change: \(value)")
	  }
	  delay(2) {
	    print("inside closure 2: \(value)")
	  }
	}
	
è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

	before closure: 42
	ğŸ•‘
	inside closure 1, before change: 42
	inside closure 1, after change: 1337
	ğŸ•‘
	inside closure 2: 1337	

ä¸Šé¢çš„ä»£ç è¯´æ˜ï¼š

*  åœ¨ Swift é—­åŒ…ä¸­ä½¿ç”¨çš„æ‰€æœ‰å¤–éƒ¨å˜é‡ï¼Œé—­åŒ…ä¼šè‡ªåŠ¨æ•è·è¿™äº›å˜é‡çš„å¼•ç”¨
*  åœ¨é—­åŒ…æ‰§è¡Œæ—¶ï¼Œä¼šæ ¹æ®è¿™äº›å˜é‡å¼•ç”¨å¾—åˆ°æ‰€å¯¹åº”çš„å…·ä½“å€¼
*  å› ä¸ºæˆ‘ä»¬æ•è·çš„æ˜¯å˜é‡çš„å¼•ç”¨ï¼ˆè€Œä¸æ˜¯å˜é‡è‡ªèº«çš„å€¼ï¼‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨é—­åŒ…å†…éƒ¨ä¿®æ”¹å˜é‡çš„å€¼ï¼ˆå½“ç„¶å˜é‡è¦å£°æ˜ä¸º varï¼Œè€Œä¸èƒ½æ˜¯ letï¼‰	

å¦‚æœæƒ³è¦åœ¨é—­åŒ…åˆ›å»ºæ—¶æ•è·å˜é‡çš„å€¼ï¼Œè€Œä¸æ˜¯åœ¨é—­åŒ…æ‰§è¡Œæ—¶æ‰å»è·å–å˜é‡çš„å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ æ•è·åˆ—è¡¨

	func demo5() {
	  var value = 42
	  print("before closure: \(value)")
	  delay(1) { [constValue = value] in
	    print("inside closure: \(constValue)")
	  }
	  value = 1337
	  print("after closure: \(value)")
	}
	
è¾“å‡ºç»“æœï¼š

	before closure: 42
	after closure: 1337
	ğŸ•‘
	inside closure: 42	
	
ä¸ä¸Šé¢çš„ demo4() æ¯”è¾ƒï¼Œè¿™æ¬¡é—­åŒ…æ‰“å°çš„æ˜¯å˜é‡åˆ›å»ºæ—¶çš„å€¼ï¼Œè€Œä¸æ˜¯åæ¥èµ‹çš„æ–°å€¼ 1337ï¼Œå³ä½¿æ•´ä¸ªé—­åŒ…çš„æ‰§è¡Œæ˜¯åœ¨å¯¹å˜é‡é‡æ–°èµ‹å€¼ä¹‹åã€‚

è¿™å°±æ˜¯ [constValue = value] åœ¨é—­åŒ…ä¸­æ‰€åšçš„äº‹æƒ…ï¼šåœ¨é—­åŒ…åˆ›å»ºæ—¶æ•è·å˜é‡ value çš„å†…å®¹ â€” è€Œä¸æ˜¯å˜é‡çš„å¼•ç”¨ã€‚

ä¸Šé¢è¯´æ˜ï¼š

*  ä½ å¯ä»¥åœ¨é—­åŒ…åˆ›å»ºæ—¶è·å–å˜é‡ä¸­çš„å€¼ï¼Œç„¶åæŠŠå®ƒå­˜å‚¨åˆ°æœ¬åœ°å¸¸é‡ä¸­ï¼Œè€Œä¸æ˜¯æ•è·å˜é‡çš„å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦ä¸­æ‹¬å·çš„æ•è·åˆ—è¡¨æ¥å®ç°ã€‚


## é˜…è¯»swiftæºç 

å‚è€ƒï¼š[å¦‚ä½•é˜…è¯» Swift æ ‡å‡†åº“ä¸­çš„æºç ](å¦‚ä½•é˜…è¯» Swift æ ‡å‡†åº“ä¸­çš„æºç )

æ€»ç»“ï¼šæ ¹æ®å®˜æ–¹[readme](https://github.com/apple/swift/blob/master/README.md)ä»æºç ç¼–è¯‘swift,å½“ build æ„å»ºå®Œæˆåï¼Œä½ å¯ä»¥åœ¨ ./build/Xcode-ReleaseAssert/swift-macosx-x86_64/ çš„å­æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ç»“æœã€‚å…¶ä¸­ä¼šæœ‰ä¸€ä¸ª Swift.xcodeproj Xcode é¡¹ç›®ã€‚

## è®¾ç½®status bar style

åœ¨info.plistæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œé€‰ä¸­è¡¨ç©ºç™½åœ°æ–¹ï¼Œå³é”®é€‰ä¸­Add Rowï¼Œ ç„¶ååœ¨åˆ—è¡¨ä¸­é€‰ä¸­æœ€åä¸€ä¸ªé€‰é¡¹ï¼Œä¹Ÿå°±æ˜¯View controller-based status bar appearanceï¼Œè®¾ç½®ä¸ºNoï¼ˆä¸æ”¯æŒåœ¨æ–‡ä»¶ä¸­è®¾ç½®çŠ¶æ€æ æ ·å¼ï¼‰ï¼Œç„¶ååœ¨AppDelegateä¸­å†™ä¸Š[UIApplication sharedApplication].statusBarStyle = UIStatusBarStyleLightContentï¼Œè¿™æ ·çš„è¯ï¼Œå…¨å±€çš„çŠ¶æ€æ æ ·å¼å°±OKäº†ã€‚å…¶ä»–çš„ç•Œé¢å¦‚æœæƒ³è¦æ”¹å˜æ ·å¼çš„è¯ï¼Œç›´æ¥ç”¨ 
[UIApplication sharedApplication].statusBarStyle = UIStatusBarStyleDefault;ä¿®æ”¹å°±å¯ä»¥äº†ã€‚